<!DOCTYPE html>
<html lang="zh-CN"><div id="translate-button" style="background-color: white; display: none; top: 236px; left: 351px;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAEgWuABIFrgFpirNTAAAMIUlEQVRo3s1Ze5RV1Xn//b597mMuw/CYEREwRhCVCisian1Q3joQQREhljSKrctXKIlpiHHFB9qoXTYrmiwa2rAqqUgaRFEBQSAIUtKFKChFCM+gCwGFgjAMM3PvOWfvr3/s+2KcQYxD9bvr3Hvufp3v9732/r4DnDL1Yfm/B3+7/lt3NOrXTn3+V4im/NuSpzer0z4vR92+bF4+N417eOGTr2RVb1+l+75sXk6ViqYz4f5Vc362T/Wa51Rr/0O393zwcOrLZi44Beb14lterLz62ze9JhkMfPUVaApgpxoYG7fTryIAAigwpoMfXHlm7+FDVxytQ989f1SkJNZUxrCySpzZvPALPl4J8AsJ4aQauOGXf7j0rMuvXvzhRnSJGiPNSKwWInGWqO4iqIrmSsszF+fNTgCMKmNwGQEDYES+7aMW5r5OYAuAegAPfCY4ttZx3+IPaw8neiza/0eXEImdVaWzSqdw6WRSzh/gtj91VeLCL6iCL0wlAFUdiWNHFQC+O++TW7/ev9OzixcAmURoARh1gMJBFS5IJKVdFffpwdW3c/9603vAGLQ/9wLNNmQZNRyFCQQE6ZyDDesJCpwCxqQYhQ1IVnbEwd3bUHfgPXY9/xJ1cYqII4RN9UhlKtFU18Tqc/pH7c7umE2mgA5GNWVs5t2tjVunT+iw+6QaqJ00fdrgqZMfWbqCSCK2RpyhAlAtU6eBYcCv/wVQmQJydQBNyXFYtjoJqPq+wgUHmCQgBrChH0MAFN9HAaIIUAcwBFIGqG6vePdPR2bMvbN68ujp+/nqlG4KNPOBm2ZvntG3z0X3rFoLaDa2psIZOEChJVcjQDpajbB9E2ER5BmPQYrnJs8oy+Bo2XdzuTV3YxIALQgHdUSkBj2qiT0fH2sEgLCprjjWAzjjEv7q4Ibfd6rD8KeegaYjp5kKNaoC4gTxk0o4eKmSzgUISxL2dlbiW0tQCOTXag6A5XdKev79A6kU0FinmaSR48caLADQ5YqrCzCeaPgA6369/OUDIZAWMEgJLcWvCPhod8Kt7xLmP+J/WTAGBeFYGOUnaeFePJtg/gMICCFghCKEvycohAiUhFII2NjmAEBdXK6BFxWNwOy7a3/18Z5fbr5gyPcW7Xsf7ZuOGSeBkogLMiygJgGlkEQAEpC85Qi9uRUsrYC6XO4Keu2VaUoVcK4gIUcfLIqap3X5yU5DnKDJZj6w/Invr+69PXvZoB/ct6xxL87Z+wE1mTBqxFJVy0BQTRCw5mzYVBo2QNH8aUBVgiyzGfWaY8E9VCEADAEVBzqFWgu6CHHDcQkOfwyNnFVQBXnQ3qycF0qZzzTfyLhz/o+3O1ReXPvD766sqUH/d98RFUdNBwUQQLqdkWQQ7944+9GRYf3eUG23hOoFqkF3QZDOP8/CxxEIoA5xJLCNIA454FBA1gVkHUVDVcT0ylOb6TW241mXjV3ELKrDMNZyd1GnrtyMWwKgAMyf5k8++u/rPrhy9KS7Fl4ztte1K9ZQG3Oi6VRMOCKZIlKJbLhx/mM70cZkdmc4dvhYZ0SYy8GBEJRCgwKALYPV0lHAApBw789yLz1+Xu3m362ZPX4kGFSI1DcFzlJos4qgQ6V0nfhass04F89L35seOqu6AhJmHcBShFUtid6Vyb2VswwccKEAwAtPDZr01rzNT948BKioEGkIjaMhXD1Ueo5sO9E7OADIdD2LQT0UqnCqeZ/zMGzkrf/Ms3sUvUBaX3GbAxIEgN8+0u/+pS99NPX6sUAqgEQWSBoEmfBw2wHIE2HV0gdaeIenZ1QRW4+kqqamdQ30HDnFlP5FRaQLHu32841LV44feR2Qi4CmCDkyaPN8oEONSVpFJ6WBiBR2SBpxsM55TZQ99VMA7rp3anLxrrrfdJ2yp/cJggEw+57h8/9n8Zxhg64DenTG+R07pm1bA3j/v98+mk3iUCoDiDFOqV4NqrCxtQBgy7j+FIAfjzyn6YpeVbeM6FfzBjDiU4e9eVNvWbV32dJrxtVi38XnJdu8KrFt5uVHNy1fMLKiG44l0mJoAgchnAJx5Me4svEt+sCUeXjj8hEV3YY//PLr+abS2QzAjLtHrZj20Jt9Nh/AkULbRQ+EreYWn5c2zRy7aeuSuYO790MuGRiRhHE0QGQlUWDmpAAYwaz8L2DgpMqhg3+wckUBBFkC8dpjVzatnSLFY+GWx5Nt6Q9c9/TEjbuWzBvS8zLYdNKIoUKdMQDgFCePQh0rYGxO8foSF/3lHUOHX/vDDUsAQPVETbQVDbtDywJH8RzLFT+9+c0tC+Zcc96lQJMN8EnW+1z5TtwigMBBq9IKzVmueA06aPIlo2p/tGkR0Cvwi/dpUxCjv4XO09/UZ3re9nZ3lMxVAWDV47es2rH0d9d+s5YYfGX3LgDQPv0ZAFSREKfIpJSJOIslr0KH3ttv9DfGTPxXP2Jrm4bP93blPmmo01uvmnjphg5/M78jTjRzrJj27d8f275x2t+N6RADwMyhPLkJUSEKAla1Mg1G9Tnu2AX06Desb1syXqDf3JO2uw/qH85owJkD/3rchv737Ti3+Zjbruj/j0/s1580b28ZAP1BWFUJB22fgdYfBj7cw7bfevNUn6VpCIHgI9ezX23vt0c8uqR/OUsAsP2bEp0SACklsj51UmoQAGDU5g5coFjJ400OYTa0B7e56j6jRq27dd6GofnuVk22ZQBShK35lIpIACY4ftoAJGsgsc8U6eJQ31vjEr2vumTljTPX33yyeS0f5ghR5zMwnwIV6h6HTlst1CXgHATqoAJQNXLLn3e4csiAudc9+tK9pZHBCUJsGYAArsSqUtXndmHDafOBI/vC40wiXxCAVgQQF0Vu8TLgukk3Pj3ue794zI+MVcr2otZqowQAEqpKEQPWfQTtPmDCIFu/Z0Z8vAG5hrQmqrqpMULSQGDgnF/cGAOoVdI6dbGN4iaqRoxtEwwBCmGjHAiDoF0Fwvjs2NbF/cIgUJCEAk5V21dQ6upDN3tRUr4z9fsPBJKumfeLu+92ZT7Rok3/w0J9Z/8B1/9oQ2ytwggIGxvNnCGs6gJoPhaQXqH5AkpZ3cJfIi2omIAt48ACCEPg6F6HOIzUSLGSRweqCFDXJGrTgUwYDbw1+93FL07/5zE4MldbBTBlqa4/+KEOqGuInFUI1dcjrALOiioUzmcaWgBSWKhYVIGyLJ6V7LEI1/9QfTlGaCl0oI8bDn478vIwYF0WqokE+30DOHAEGw68v//Ot6d2f6dFHwgTXkrO+nqN07zUVEHGFFomxDEQlUBUAqqYEy4nhkojjoaOBv4SOAa0NIz9LywFMYgYUAdVqFMqitVGzWtMtUOGzDVpvGMrMHkcBvS9tNuNrfoAFQwtkYsCFzuFeNMo5KZFYZcyv2LiWpR3oZqqILXYTxYrS8wXfQQqBI1YMSyd9AuPJAAR4ZF6xF/rhmDMQOC5f9nyyPM/n/ZTAGwRwJAuOG+LAz5pkMBab8tBXt1hCBgBTMIbiSuU3srrNwTo4CvNZYFXNV9hzE/RAMgFQM4CR/YGCBtjDQLHokDytbswhK3KmOD6EcSchxfetXrWDTP9ipXSIoD/XLT/n/YfqutxcOf7UcJEcaJdRkwiUwENTEV1Z6dKZA8fg/NFf1AIdf6kq+qIOFYGApAK56AkTEKUJOLI7+bJdEoDUc3u3Yo4JHqNvmlsu07J7rl6X07M1yapEGutMeMmMlo1d/WE1bNuWOC5/CsBDulp21k/L139wOEFvS7rfP3Hu0MHqiippDgJAnPRFWg8tPbVwc/+/Zj1fvTtBJ759PuBcrrrJaUm/OlHDVToX2K4OB8uU8CssmPtbSu1zP6BZ4dRb1vm26SZeaUzwNYPYrwx+y1g2dUKADXnd+pkGwClU6jAKTVTFZiuF+LgjiWvDFn00I1b81CLzAOnIbv6c+k7L+ua3GE38Eh9FFtF0LlLColqbNu1aFbt+hm378GJb0+L9FnviVul8S8oX5zQ8ivS8S+UtNHamOaUOwKTjQkVmHN7ppAzWLv8iftH/O+aJxvzQ770d9InpTEzde3fzlOdukZ1wnO6uGbgEwUhfGWs5KT0o1d056+3qF5157rZZc3mz17w/5PunaUyZ4vuHPaTLc9/Xub/D61PrC9fCdQYAAAAAElFTkSuQmCC"></div><head>
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="baidu-site-verification" content="code-7nivAemV0f">
    <meta name="generator" content="Hugo 0.54.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Go语言基础之单元测试 | 李文周的博客</title>
    <meta property="og:title" content="Go语言基础之单元测试 - 李文周的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2017-06-27T21:00:10+08:00">
        
        
    <meta property="article:modified_time" content="2017-06-27T21:00:10+08:00">
        
    <meta name="Keywords" content="Go,Go 教程,Go 语言教程,李文周,七米">
    <meta name="description" content="李文周的Blog Go语言测试 单元测试 go test">
        
    <meta name="author" content="李文周">
    <meta property="og:url" content="https://www.liwenzhou.com/posts/Go/16_test/">
    <link rel="shortcut icon" href="https://www.liwenzhou.com/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/normalize.css">
    
        <link rel="stylesheet" href="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/prism.css">
    
    <link rel="stylesheet" href="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/style.css">
    <script src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/hm.js"></script><script type="text/javascript" src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/jquery.js"></script>

    


    
    
        <link rel="stylesheet" href="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/sidebar_menu.css">
    
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e0a55b64495e292a238b463a78dd56da";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>

<body><div id="MathJax_Message" style="display: none;"></div>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://www.liwenzhou.com/">
                        李文周的博客
                    </a>
                
                <p class="description">Go 语言教程 Go语言学习QQ群：645090316 微信公众号：李文周</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://www.liwenzhou.com/">首页</a>
                    
                    <a href="https://www.liwenzhou.com/archives/" title="归档">归档</a>
                    
                    <a href="https://www.liwenzhou.com/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">Go语言基础之单元测试</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2017年6月27日
                        </date>
                        
                        <div class="post-meta meta-category">
                            |
                            
                                <a href="https://www.liwenzhou.com/categories/Golang">Golang</a>
                            
                        </div>
                        
                        
                        <div class="post-meta">
                            <span id="busuanzi_container_page_pv" style="display: inline;">
                                本文总阅读量<span id="busuanzi_value_page_pv">9079</span>次
                            </span>
                        </div>
                        
                        <div class="post-content">
                            <p>不写测试的开发不是好程序员。我个人非常崇尚TDD（Test Driven Development）的，然而可惜的是国内的程序员都不太关注测试这一部分。
这篇文章主要介绍下在Go语言中如何做单元测试和基准测试。</p>

<h1 id="autoid-0-0-0">go test工具</h1>

<p>Go语言中的测试依赖<code>go test</code>命令。编写测试代码和编写普通的Go代码过程是类似的，并不需要学习新的语法、规则或工具。</p>

<p>go test命令是一个按照一定约定和组织的测试代码的驱动程序。在包目录内，所有以<code>_test.go</code>为后缀名的源代码文件都是<code>go test</code>测试的一部分，不会被<code>go build</code>编译到最终的可执行文件中。</p>

<p>在<code>*_test.go</code>文件中有三种类型的函数，单元测试函数、基准测试函数和示例函数。</p>

<table>
<thead>
<tr>
<th>类型</th>
<th>格式</th>
<th>作用</th>
</tr>
</thead>

<tbody>
<tr>
<td>测试函数</td>
<td>函数名前缀为Test</td>
<td>测试程序的一些逻辑行为是否正确</td>
</tr>

<tr>
<td>基准函数</td>
<td>函数名前缀为Benchmark</td>
<td>测试函数的性能</td>
</tr>

<tr>
<td>示例函数</td>
<td>函数名前缀为Example</td>
<td>为文档提供示例文档</td>
</tr>
</tbody>
</table>

<p><code>go test</code>命令会遍历所有的<code>*_test.go</code>文件中符合上述命名规则的函数，然后生成一个临时的main包用于调用相应的测试函数，然后构建并运行、报告测试结果，最后清理测试中生成的临时文件。</p>

<h1 id="autoid-1-0-0">测试函数</h1>

<h2 id="autoid-2-0-0">测试函数的格式</h2>

<p>每个测试函数必须导入<code>testing</code>包，测试函数的基本格式（签名）如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">TestName</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>测试函数的名字必须以<code>Test</code>开头，可选的后缀名必须以大写字母开头，举几个例子：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">TestAdd</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-func">func</span> <span class="token function">TestSum</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-func">func</span> <span class="token function">TestLog</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>其中参数<code>t</code>用于报告测试失败和附加的日志信息。
<code>testing.T</code>的拥有的方法如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span>args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Errorf</span><span class="token punctuation">(</span>format <span class="token builtin">string</span><span class="token punctuation">,</span> args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">FailNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Failed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Fatal</span><span class="token punctuation">(</span>args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Fatalf</span><span class="token punctuation">(</span>format <span class="token builtin">string</span><span class="token punctuation">,</span> args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Log</span><span class="token punctuation">(</span>args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Logf</span><span class="token punctuation">(</span>format <span class="token builtin">string</span><span class="token punctuation">,</span> args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> f <span class="token keyword keyword-func">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Skip</span><span class="token punctuation">(</span>args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">SkipNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Skipf</span><span class="token punctuation">(</span>format <span class="token builtin">string</span><span class="token punctuation">,</span> args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Skipped</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="autoid-2-1-0">测试函数示例</h2>

<p>就像细胞是构成我们身体的基本单位，一个软件程序也是由很多单元组件构成的。单元组件可以是函数、结构体、方法和最终用户可能依赖的任意东西。总之我们需要确保这些组件是能够正常运行的。单元测试是一些利用各种方法测试单元组件的程序，它会将结果与预期输出进行比较。</p>

<p>接下来，我们定义一个<code>split</code>的包，包中定义了一个<code>Split</code>函数，具体实现如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token comment">// split/split.go</span>

<span class="token keyword keyword-package">package</span> split

<span class="token keyword keyword-import">import</span> <span class="token string">"strings"</span>

<span class="token comment">// split package with a single split function.</span>

<span class="token comment">// Split slices s into all substrings separated by sep and</span>
<span class="token comment">// returns a slice of the substrings between those separators.</span>
<span class="token keyword keyword-func">func</span> <span class="token function">Split</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>result <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	i <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep<span class="token punctuation">)</span>

	<span class="token keyword keyword-for">for</span> i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span>
		result <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
		s <span class="token operator">=</span> s<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
		i <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	result <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> s<span class="token punctuation">)</span>
	<span class="token keyword keyword-return">return</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在当前目录下，我们创建一个<code>split_test.go</code>的测试文件，并定义一个测试函数如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token comment">// split/split_test.go</span>

<span class="token keyword keyword-package">package</span> split

<span class="token keyword keyword-import">import</span> <span class="token punctuation">(</span>
	<span class="token string">"reflect"</span>
	<span class="token string">"testing"</span>
<span class="token punctuation">)</span>

<span class="token keyword keyword-func">func</span> <span class="token function">TestSplit</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 测试函数名必须以Test开头，必须接收一个*testing.T类型参数</span>
	got <span class="token operator">:=</span> <span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">"a:b:c"</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">)</span>         <span class="token comment">// 程序输出的结果</span>
	want <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">}</span>    <span class="token comment">// 期望的结果</span>
	<span class="token keyword keyword-if">if</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>want<span class="token punctuation">,</span> got<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 因为slice不能比较直接，借助反射包中的方法比较</span>
		t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"excepted:%v, got:%v"</span><span class="token punctuation">,</span> want<span class="token punctuation">,</span> got<span class="token punctuation">)</span> <span class="token comment">// 测试失败输出错误提示</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时<code>split</code>这个包中的文件如下：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ <span class="token function">ls</span> -l
total 16
-rw-r--r--  1 liwenzhou  staff  408  4 29 15:50 split.go
-rw-r--r--  1 liwenzhou  staff  466  4 29 16:04 split_test.go
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>在<code>split</code>包路径下，执行<code>go test</code>命令，可以看到输出结果如下：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span>
PASS
ok      github.com/Q1mi/studygo/code_demo/test_demo/split       0.005s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>一个测试用例有点单薄，我们再编写一个测试使用多个字符切割字符串的例子，在<code>split_test.go</code>中添加如下测试函数：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">TestMoreSplit</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	got <span class="token operator">:=</span> <span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">"abcd"</span><span class="token punctuation">,</span> <span class="token string">"bc"</span><span class="token punctuation">)</span>
	want <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">}</span>
	<span class="token keyword keyword-if">if</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>want<span class="token punctuation">,</span> got<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"excepted:%v, got:%v"</span><span class="token punctuation">,</span> want<span class="token punctuation">,</span> got<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>再次运行<code>go test</code>命令，输出结果如下：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span>
--- FAIL: TestMultiSplit <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
    split_test.go:20: excepted:<span class="token punctuation">[</span>a d<span class="token punctuation">]</span>, got:<span class="token punctuation">[</span>a cd<span class="token punctuation">]</span>
FAIL
<span class="token keyword keyword-exit">exit</span> status 1
FAIL    github.com/Q1mi/studygo/code_demo/test_demo/split       0.006s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这一次，我们的测试失败了。我们可以为<code>go test</code>命令添加<code>-v</code>参数，查看测试函数名称和运行时间：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -v
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit
--- PASS: TestSplit <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestMoreSplit
--- FAIL: TestMoreSplit <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
    split_test.go:21: excepted:<span class="token punctuation">[</span>a d<span class="token punctuation">]</span>, got:<span class="token punctuation">[</span>a cd<span class="token punctuation">]</span>
FAIL
<span class="token keyword keyword-exit">exit</span> status 1
FAIL    github.com/Q1mi/studygo/code_demo/test_demo/split       0.005s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这一次我们能清楚的看到是<code>TestMoreSplit</code>这个测试没有成功。
还可以在<code>go test</code>命令后添加<code>-run</code>参数，它对应一个正则表达式，只有函数名匹配上的测试函数才会被<code>go test</code>命令执行。</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -v -run<span class="token operator">=</span><span class="token string">"More"</span>
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestMoreSplit
--- FAIL: TestMoreSplit <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
    split_test.go:21: excepted:<span class="token punctuation">[</span>a d<span class="token punctuation">]</span>, got:<span class="token punctuation">[</span>a cd<span class="token punctuation">]</span>
FAIL
<span class="token keyword keyword-exit">exit</span> status 1
FAIL    github.com/Q1mi/studygo/code_demo/test_demo/split       0.006s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>现在我们回过头来解决我们程序中的问题。很显然我们最初的<code>split</code>函数并没有考虑到sep为多个字符的情况，我们来修复下这个Bug：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-package">package</span> split

<span class="token keyword keyword-import">import</span> <span class="token string">"strings"</span>

<span class="token comment">// split package with a single split function.</span>

<span class="token comment">// Split slices s into all substrings separated by sep and</span>
<span class="token comment">// returns a slice of the substrings between those separators.</span>
<span class="token keyword keyword-func">func</span> <span class="token function">Split</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>result <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	i <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep<span class="token punctuation">)</span>

	<span class="token keyword keyword-for">for</span> i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span>
		result <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
		s <span class="token operator">=</span> s<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token function">len</span><span class="token punctuation">(</span>sep<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment">// 这里使用len(sep)获取sep的长度</span>
		i <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	result <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> s<span class="token punctuation">)</span>
	<span class="token keyword keyword-return">return</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这一次我们再来测试一下，我们的程序。注意，当我们修改了我们的代码之后不要仅仅执行那些失败的测试函数，我们应该完整的运行所有的测试，保证不会因为修改代码而引入了新的问题。</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -v
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit
--- PASS: TestSplit <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestMoreSplit
--- PASS: TestMoreSplit <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
PASS
ok      github.com/Q1mi/studygo/code_demo/test_demo/split       0.006s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这一次我们的测试都通过了。</p>

<h2 id="autoid-2-2-0">测试组</h2>

<p>我们现在还想要测试一下<code>split</code>函数对中文字符串的支持，这个时候我们可以再编写一个<code>TestChineseSplit</code>测试函数，但是我们也可以使用如下更友好的一种方式来添加更多的测试用例。</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">TestSplit</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 定义一个测试用例类型</span>
	<span class="token keyword keyword-type">type</span> test <span class="token keyword keyword-struct">struct</span> <span class="token punctuation">{</span>
		input <span class="token builtin">string</span>
		sep   <span class="token builtin">string</span>
		want  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 定义一个存储测试用例的切片</span>
	tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>test<span class="token punctuation">{</span>
		<span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"a:b:c"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">":"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"a:b:c"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">","</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a:b:c"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"abcd"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">"bc"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"沙河有沙又有河"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">"沙"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"河有"</span><span class="token punctuation">,</span> <span class="token string">"又有河"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 遍历切片，逐一执行测试用例</span>
	<span class="token keyword keyword-for">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tc <span class="token operator">:=</span> <span class="token keyword keyword-range">range</span> tests <span class="token punctuation">{</span>
		got <span class="token operator">:=</span> <span class="token function">Split</span><span class="token punctuation">(</span>tc<span class="token punctuation">.</span>input<span class="token punctuation">,</span> tc<span class="token punctuation">.</span>sep<span class="token punctuation">)</span>
		<span class="token keyword keyword-if">if</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> tc<span class="token punctuation">.</span>want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"excepted:%v, got:%v"</span><span class="token punctuation">,</span> tc<span class="token punctuation">.</span>want<span class="token punctuation">,</span> got<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们通过上面的代码把多个测试用例合到一起，再次执行<code>go test</code>命令。</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -v
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit
--- FAIL: TestSplit <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
    split_test.go:42: excepted:<span class="token punctuation">[</span>河有 又有河<span class="token punctuation">]</span>, got:<span class="token punctuation">[</span> 河有 又有河<span class="token punctuation">]</span>
FAIL
<span class="token keyword keyword-exit">exit</span> status 1
FAIL    github.com/Q1mi/studygo/code_demo/test_demo/split       0.006s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们的测试出现了问题，仔细看打印的测试失败提示信息：<code>excepted:[河有 又有河], got:[ 河有 又有河]</code>，你会发现<code>[ 河有 又有河]</code>中有个不明显的空串，这种情况下十分推荐使用<code>%#v</code>的格式化方式。</p>

<p>我们修改下测试用例的格式化输出错误提示部分：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">TestSplit</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   
	<span class="token keyword keyword-for">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tc <span class="token operator">:=</span> <span class="token keyword keyword-range">range</span> tests <span class="token punctuation">{</span>
		got <span class="token operator">:=</span> <span class="token function">Split</span><span class="token punctuation">(</span>tc<span class="token punctuation">.</span>input<span class="token punctuation">,</span> tc<span class="token punctuation">.</span>sep<span class="token punctuation">)</span>
		<span class="token keyword keyword-if">if</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> tc<span class="token punctuation">.</span>want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"excepted:%#v, got:%#v"</span><span class="token punctuation">,</span> tc<span class="token punctuation">.</span>want<span class="token punctuation">,</span> got<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时运行<code>go test</code>命令后就能看到比较明显的提示信息了：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -v
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit
--- FAIL: TestSplit <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
    split_test.go:42: excepted:<span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token punctuation">{</span><span class="token string">"河有"</span>, <span class="token string">"又有河"</span><span class="token punctuation">}</span>, got:<span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token punctuation">{</span><span class="token string">""</span>, <span class="token string">"河有"</span>, <span class="token string">"又有河"</span><span class="token punctuation">}</span>
FAIL
<span class="token keyword keyword-exit">exit</span> status 1
FAIL    github.com/Q1mi/studygo/code_demo/test_demo/split       0.006s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="autoid-2-3-0">子测试</h2>

<p>看起来都挺不错的，但是如果测试用例比较多的时候，我们是没办法一眼看出来具体是哪个测试用例失败了。我们可能会想到下面的解决办法：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">TestSplit</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword keyword-type">type</span> test <span class="token keyword keyword-struct">struct</span> <span class="token punctuation">{</span> <span class="token comment">// 定义test结构体</span>
		input <span class="token builtin">string</span>
		sep   <span class="token builtin">string</span>
		want  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
	<span class="token punctuation">}</span>
	tests <span class="token operator">:=</span> <span class="token keyword keyword-map">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>test<span class="token punctuation">{</span> <span class="token comment">// 测试用例使用map存储</span>
		<span class="token string">"simple"</span><span class="token punctuation">:</span>      <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"a:b:c"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">":"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"wrong sep"</span><span class="token punctuation">:</span>   <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"a:b:c"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">","</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a:b:c"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"more sep"</span><span class="token punctuation">:</span>    <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"abcd"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">"bc"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"leading sep"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"沙河有沙又有河"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">"沙"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"河有"</span><span class="token punctuation">,</span> <span class="token string">"又有河"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-for">for</span> name<span class="token punctuation">,</span> tc <span class="token operator">:=</span> <span class="token keyword keyword-range">range</span> tests <span class="token punctuation">{</span>
		got <span class="token operator">:=</span> <span class="token function">Split</span><span class="token punctuation">(</span>tc<span class="token punctuation">.</span>input<span class="token punctuation">,</span> tc<span class="token punctuation">.</span>sep<span class="token punctuation">)</span>
		<span class="token keyword keyword-if">if</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> tc<span class="token punctuation">.</span>want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"name:%s excepted:%#v, got:%#v"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> tc<span class="token punctuation">.</span>want<span class="token punctuation">,</span> got<span class="token punctuation">)</span> <span class="token comment">// 将测试用例的name格式化输出</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面的做法是能够解决问题的。同时Go1.7+中新增了子测试，我们可以按照如下方式使用<code>t.Run</code>执行子测试：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">TestSplit</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword keyword-type">type</span> test <span class="token keyword keyword-struct">struct</span> <span class="token punctuation">{</span> <span class="token comment">// 定义test结构体</span>
		input <span class="token builtin">string</span>
		sep   <span class="token builtin">string</span>
		want  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
	<span class="token punctuation">}</span>
	tests <span class="token operator">:=</span> <span class="token keyword keyword-map">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>test<span class="token punctuation">{</span> <span class="token comment">// 测试用例使用map存储</span>
		<span class="token string">"simple"</span><span class="token punctuation">:</span>      <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"a:b:c"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">":"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"wrong sep"</span><span class="token punctuation">:</span>   <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"a:b:c"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">","</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a:b:c"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"more sep"</span><span class="token punctuation">:</span>    <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"abcd"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">"bc"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"leading sep"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"沙河有沙又有河"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">"沙"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"河有"</span><span class="token punctuation">,</span> <span class="token string">"又有河"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-for">for</span> name<span class="token punctuation">,</span> tc <span class="token operator">:=</span> <span class="token keyword keyword-range">range</span> tests <span class="token punctuation">{</span>
		t<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-func">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 使用t.Run()执行子测试</span>
			got <span class="token operator">:=</span> <span class="token function">Split</span><span class="token punctuation">(</span>tc<span class="token punctuation">.</span>input<span class="token punctuation">,</span> tc<span class="token punctuation">.</span>sep<span class="token punctuation">)</span>
			<span class="token keyword keyword-if">if</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> tc<span class="token punctuation">.</span>want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"excepted:%#v, got:%#v"</span><span class="token punctuation">,</span> tc<span class="token punctuation">.</span>want<span class="token punctuation">,</span> got<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时我们再执行<code>go test</code>命令就能够看到更清晰的输出内容了：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -v
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit/leading_sep
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit/simple
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit/wrong_sep
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit/more_sep
--- FAIL: TestSplit <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
    --- FAIL: TestSplit/leading_sep <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
        split_test.go:83: excepted:<span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token punctuation">{</span><span class="token string">"河有"</span>, <span class="token string">"又有河"</span><span class="token punctuation">}</span>, got:<span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token punctuation">{</span><span class="token string">""</span>, <span class="token string">"河有"</span>, <span class="token string">"又有河"</span><span class="token punctuation">}</span>
    --- PASS: TestSplit/simple <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
    --- PASS: TestSplit/wrong_sep <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
    --- PASS: TestSplit/more_sep <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
FAIL
<span class="token keyword keyword-exit">exit</span> status 1
FAIL    github.com/Q1mi/studygo/code_demo/test_demo/split       0.006s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这个时候我们要把测试用例中的错误修改回来：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">TestSplit</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>
	tests <span class="token operator">:=</span> <span class="token keyword keyword-map">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>test<span class="token punctuation">{</span> <span class="token comment">// 测试用例使用map存储</span>
		<span class="token string">"simple"</span><span class="token punctuation">:</span>      <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"a:b:c"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">":"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"wrong sep"</span><span class="token punctuation">:</span>   <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"a:b:c"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">","</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a:b:c"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"more sep"</span><span class="token punctuation">:</span>    <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"abcd"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">"bc"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"leading sep"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"沙河有沙又有河"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">"沙"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"河有"</span><span class="token punctuation">,</span> <span class="token string">"又有河"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们都知道可以通过<code>-run=RegExp</code>来指定运行的测试用例，还可以通过<code>/</code>来指定要运行的子测试用例，例如：<code>go test -v -run=Split/simple</code>只会运行<code>simple</code>对应的子测试用例。</p>

<h2 id="autoid-2-4-0">测试覆盖率</h2>

<p>测试覆盖率是你的代码被测试套件覆盖的百分比。通常我们使用的都是语句的覆盖率，也就是在测试中至少被运行一次的代码占总代码的比例。</p>

<p>Go提供内置功能来检查你的代码覆盖率。我们可以使用<code>go test -cover</code>来查看测试覆盖率。例如：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -cover
PASS
coverage: 100.0% of statements
ok      github.com/Q1mi/studygo/code_demo/test_demo/split       0.005s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>从上面的结果可以看到我们的测试用例覆盖了100%的代码。</p>

<p>Go还提供了一个额外的<code>-coverprofile</code>参数，用来将覆盖率相关的记录信息输出到一个文件。例如：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -cover -coverprofile<span class="token operator">=</span>c.out
PASS
coverage: 100.0% of statements
ok      github.com/Q1mi/studygo/code_demo/test_demo/split       0.005s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面的命令会将覆盖率相关的信息输出到当前文件夹下面的<code>c.out</code>文件中，然后我们执行<code>go tool cover -html=c.out</code>，使用<code>cover</code>工具来处理生成的记录信息，该命令会打开本地的浏览器窗口生成一个HTML报告。
<img src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/cover.png" alt="Go test cover">
上图中每个用绿色标记的语句块表示被覆盖了，而红色的表示没有被覆盖。</p>

<h1 id="autoid-2-5-0">基准测试</h1>

<h2 id="autoid-3-0-0">基准测试函数格式</h2>

<p>基准测试就是在一定的工作负载之下检测程序性能的一种方法。基准测试的基本格式如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkName</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>基准测试以<code>Benchmark</code>为前缀，需要一个<code>*testing.B</code>类型的参数b，基准测试必须要执行<code>b.N</code>次，这样的测试才有对照性，<code>b.N</code>的值是系统根据实际情况去调整的，从而保证测试的稳定性。
<code>testing.B</code>拥有的方法如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span>args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Errorf</span><span class="token punctuation">(</span>format <span class="token builtin">string</span><span class="token punctuation">,</span> args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">FailNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Failed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Fatal</span><span class="token punctuation">(</span>args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Fatalf</span><span class="token punctuation">(</span>format <span class="token builtin">string</span><span class="token punctuation">,</span> args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Log</span><span class="token punctuation">(</span>args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Logf</span><span class="token punctuation">(</span>format <span class="token builtin">string</span><span class="token punctuation">,</span> args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">ReportAllocs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">ResetTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> f <span class="token keyword keyword-func">func</span><span class="token punctuation">(</span>b <span class="token operator">*</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">RunParallel</span><span class="token punctuation">(</span>body <span class="token keyword keyword-func">func</span><span class="token punctuation">(</span><span class="token operator">*</span>PB<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">SetBytes</span><span class="token punctuation">(</span>n <span class="token builtin">int64</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">SetParallelism</span><span class="token punctuation">(</span>p <span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Skip</span><span class="token punctuation">(</span>args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">SkipNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Skipf</span><span class="token punctuation">(</span>format <span class="token builtin">string</span><span class="token punctuation">,</span> args <span class="token operator">...</span><span class="token keyword keyword-interface">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">Skipped</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">StartTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-func">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>B<span class="token punctuation">)</span> <span class="token function">StopTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="autoid-3-1-0">基准测试示例</h2>

<p>我们为split包中的<code>Split</code>函数编写基准测试如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkSplit</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword keyword-for">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">"沙河有沙又有河"</span><span class="token punctuation">,</span> <span class="token string">"沙"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>基准测试并不会默认执行，需要增加<code>-bench</code>参数，所以我们通过执行<code>go test -bench=Split</code>命令执行基准测试，输出结果如下：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -bench<span class="token operator">=</span>Split
goos: darwin
goarch: amd64
pkg: github.com/Q1mi/studygo/code_demo/test_demo/split
BenchmarkSplit-8        10000000               203 ns/op
PASS
ok      github.com/Q1mi/studygo/code_demo/test_demo/split       2.255s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中<code>BenchmarkSplit-8</code>表示对Split函数进行基准测试，数字<code>8</code>表示<code>GOMAXPROCS</code>的值，这个对于并发基准测试很重要。<code>10000000</code>和<code>203ns/op</code>表示每次调用<code>Split</code>函数耗时<code>203ns</code>，这个结果是<code>10000000</code>次调用的平均值。</p>

<p>我们还可以为基准测试添加<code>-benchmem</code>参数，来获得内存分配的统计数据。</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -bench<span class="token operator">=</span>Split -benchmem
goos: darwin
goarch: amd64
pkg: github.com/Q1mi/studygo/code_demo/test_demo/split
BenchmarkSplit-8        10000000               215 ns/op             112 B/op          3 allocs/op
PASS
ok      github.com/Q1mi/studygo/code_demo/test_demo/split       2.394s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中，<code>112 B/op</code>表示每次操作内存分配了112字节，<code>3 allocs/op</code>则表示每次操作进行了3次内存分配。
我们将我们的<code>Split</code>函数优化如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">Split</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>result <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	result <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
	i <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep<span class="token punctuation">)</span>
	<span class="token keyword keyword-for">for</span> i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span>
		result <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
		s <span class="token operator">=</span> s<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token function">len</span><span class="token punctuation">(</span>sep<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment">// 这里使用len(sep)获取sep的长度</span>
		i <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	result <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> s<span class="token punctuation">)</span>
	<span class="token keyword keyword-return">return</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这一次我们提前使用make函数将result初始化为一个容量足够大的切片，而不再像之前一样通过调用append函数来追加。我们来看一下这个改进会带来多大的性能提升：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -bench<span class="token operator">=</span>Split -benchmem
goos: darwin
goarch: amd64
pkg: github.com/Q1mi/studygo/code_demo/test_demo/split
BenchmarkSplit-8        10000000               127 ns/op              48 B/op          1 allocs/op
PASS
ok      github.com/Q1mi/studygo/code_demo/test_demo/split       1.423s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这个使用make函数提前分配内存的改动，减少了2/3的内存分配次数，并且减少了一半的内存分配。</p>

<h2 id="autoid-3-2-0">性能比较函数</h2>

<p>上面的基准测试只能得到给定操作的绝对耗时，但是在很多性能问题是发生在两个不同操作之间的相对耗时，比如同一个函数处理1000个元素的耗时与处
理1万甚至100万个元素的耗时的差别是多少？再或者对于同一个任务究竟使用哪种算法性能最佳？我们通常需要对两个不同算法的实现使用相同的输入来进行基
准比较测试。</p>

<p>性能比较函数通常是一个带有参数的函数，被多个不同的Benchmark函数传入不同的值来调用。举个例子如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">benchmark</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">,</span> size <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span>
<span class="token keyword keyword-func">func</span> <span class="token function">Benchmark10</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">benchmark</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-func">func</span> <span class="token function">Benchmark100</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">benchmark</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-func">func</span> <span class="token function">Benchmark1000</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">benchmark</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>例如我们编写了一个计算斐波那契数列的函数如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token comment">// fib.go</span>

<span class="token comment">// Fib 是一个计算第n个斐波那契数的函数</span>
<span class="token keyword keyword-func">func</span> <span class="token function">Fib</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
	<span class="token keyword keyword-if">if</span> n <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> n
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-return">return</span> <span class="token function">Fib</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">Fib</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们编写的性能比较函数如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token comment">// fib_test.go</span>

<span class="token keyword keyword-func">func</span> <span class="token function">benchmarkFib</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">,</span> n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword keyword-for">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token function">Fib</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkFib1</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span>  <span class="token punctuation">{</span> <span class="token function">benchmarkFib</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkFib2</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span>  <span class="token punctuation">{</span> <span class="token function">benchmarkFib</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkFib3</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span>  <span class="token punctuation">{</span> <span class="token function">benchmarkFib</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkFib10</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">benchmarkFib</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkFib20</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">benchmarkFib</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkFib40</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">benchmarkFib</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行基准测试：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -bench<span class="token operator">=</span>.
goos: darwin
goarch: amd64
pkg: github.com/Q1mi/studygo/code_demo/test_demo/fib
BenchmarkFib1-8         1000000000               2.03 ns/op
BenchmarkFib2-8         300000000                5.39 ns/op
BenchmarkFib3-8         200000000                9.71 ns/op
BenchmarkFib10-8         5000000               325 ns/op
BenchmarkFib20-8           30000             42460 ns/op
BenchmarkFib40-8               2         638524980 ns/op
PASS
ok      github.com/Q1mi/studygo/code_demo/test_demo/fib 12.944s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里需要注意的是，默认情况下，每个基准测试至少运行1秒。如果在Benchmark函数返回时没有到1秒，则b.N的值会按1,2,5,10,20,50，…增加，并且函数再次运行。</p>

<p>最终的BenchmarkFib40只运行了两次，每次运行的平均值只有不到一秒。像这种情况下我们应该可以使用<code>-benchtime</code>标志增加最小基准时间，以产生更准确的结果。例如：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -bench<span class="token operator">=</span>Fib40 -benchtime<span class="token operator">=</span>20s
goos: darwin
goarch: amd64
pkg: github.com/Q1mi/studygo/code_demo/test_demo/fib
BenchmarkFib40-8              50         663205114 ns/op
PASS
ok      github.com/Q1mi/studygo/code_demo/test_demo/fib 33.849s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这一次<code>BenchmarkFib40</code>函数运行了50次，结果就会更准确一些了。</p>

<p>使用性能比较函数做测试的时候一个容易犯的错误就是把<code>b.N</code>作为输入的大小，例如以下两个例子都是错误的示范：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token comment">// 错误示范1</span>
<span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkFibWrong</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword keyword-for">for</span> n <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> n<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token function">Fib</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 错误示范2</span>
<span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkFibWrong2</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">Fib</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>N<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="autoid-3-3-0">重置时间</h2>

<p><code>b.ResetTimer</code>之前的处理不会放到执行时间里，也不会输出到报告中，所以可以在之前做一些不计划作为测试报告的操作。例如：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkSplit</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token comment">// 假设需要做一些耗时的无关操作</span>
	b<span class="token punctuation">.</span><span class="token function">ResetTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment">// 重置计时器</span>
	<span class="token keyword keyword-for">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">"沙河有沙又有河"</span><span class="token punctuation">,</span> <span class="token string">"沙"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="autoid-3-4-0">并行测试</h2>

<p><code>func (b *B) RunParallel(body func(*PB))</code>会以并行的方式执行给定的基准测试。</p>

<p><code>RunParallel</code>会创建出多个<code>goroutine</code>，并将<code>b.N</code>分配给这些<code>goroutine</code>执行， 其中<code>goroutine</code>数量的默认值为<code>GOMAXPROCS</code>。用户如果想要增加非CPU受限（non-CPU-bound）基准测试的并行性， 那么可以在<code>RunParallel</code>之前调用<code>SetParallelism</code> 。<code>RunParallel</code>通常会与<code>-cpu</code>标志一同使用。</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">BenchmarkSplitParallel</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// b.SetParallelism(1) // 设置使用的CPU数</span>
	b<span class="token punctuation">.</span><span class="token function">RunParallel</span><span class="token punctuation">(</span><span class="token keyword keyword-func">func</span><span class="token punctuation">(</span>pb <span class="token operator">*</span>testing<span class="token punctuation">.</span>PB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> pb<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">"沙河有沙又有河"</span><span class="token punctuation">,</span> <span class="token string">"沙"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行一下基准测试：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -bench<span class="token operator">=</span>.
goos: darwin
goarch: amd64
pkg: github.com/Q1mi/studygo/code_demo/test_demo/split
BenchmarkSplit-8                10000000               131 ns/op
BenchmarkSplitParallel-8        50000000                36.1 ns/op
PASS
ok      github.com/Q1mi/studygo/code_demo/test_demo/split       3.308s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>还可以通过在测试命令后添加<code>-cpu</code>参数如<code>go test -bench=. -cpu 1</code>来指定使用的CPU数量。</p>

<h1 id="autoid-3-5-0">Setup与TearDown</h1>

<p>测试程序有时需要在测试之前进行额外的设置（setup）或在测试之后进行拆卸（teardown）。</p>

<h2 id="autoid-4-0-0">TestMain</h2>

<p>通过在<code>*_test.go</code>文件中定义<code>TestMain</code>函数来可以在测试之前进行额外的设置（setup）或在测试之后进行拆卸（teardown）操作。</p>

<p>如果测试文件包含函数:<code>func TestMain(m *testing.M)</code>那么生成的测试会先调用 TestMain(m)，然后再运行具体测试。<code>TestMain</code>运行在主<code>goroutine</code>中, 可以在调用 <code>m.Run</code>前后做任何设置（setup）和拆卸（teardown）。退出测试的时候应该使用<code>m.Run</code>的返回值作为参数调用<code>os.Exit</code>。</p>

<p>一个使用<code>TestMain</code>来设置Setup和TearDown的示例如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">TestMain</span><span class="token punctuation">(</span>m <span class="token operator">*</span>testing<span class="token punctuation">.</span>M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"write setup code here..."</span><span class="token punctuation">)</span> <span class="token comment">// 测试之前的做一些设置</span>
	<span class="token comment">// 如果 TestMain 使用了 flags，这里应该加上flag.Parse()</span>
	retCode <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                         <span class="token comment">// 执行测试</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"write teardown code here..."</span><span class="token punctuation">)</span> <span class="token comment">// 测试之后做一些拆卸工作</span>
	os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span>retCode<span class="token punctuation">)</span>                           <span class="token comment">// 退出测试</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>需要注意的是：在调用<code>TestMain</code>时, <code>flag.Parse</code>并没有被调用。所以如果<code>TestMain</code> 依赖于command-line标志 (包括 testing 包的标记), 则应该显示的调用<code>flag.Parse</code>。</p>

<h2 id="autoid-4-1-0">子测试的Setup与Teardown</h2>

<p>有时候我们可能需要为每个测试集设置Setup与Teardown，也有可能需要为每个子测试设置Setup与Teardown。下面我们定义两个函数工具函数如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token comment">// 测试集的Setup与Teardown</span>
<span class="token keyword keyword-func">func</span> <span class="token function">setupTestCase</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token keyword keyword-func">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	t<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"如有需要在此执行:测试之前的setup"</span><span class="token punctuation">)</span>
	<span class="token keyword keyword-return">return</span> <span class="token keyword keyword-func">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		t<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"如有需要在此执行:测试之后的teardown"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 子测试的Setup与Teardown</span>
<span class="token keyword keyword-func">func</span> <span class="token function">setupSubTest</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token keyword keyword-func">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	t<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"如有需要在此执行:子测试之前的setup"</span><span class="token punctuation">)</span>
	<span class="token keyword keyword-return">return</span> <span class="token keyword keyword-func">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		t<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"如有需要在此执行:子测试之后的teardown"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用方式如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">TestSplit</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword keyword-type">type</span> test <span class="token keyword keyword-struct">struct</span> <span class="token punctuation">{</span> <span class="token comment">// 定义test结构体</span>
		input <span class="token builtin">string</span>
		sep   <span class="token builtin">string</span>
		want  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
	<span class="token punctuation">}</span>
	tests <span class="token operator">:=</span> <span class="token keyword keyword-map">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>test<span class="token punctuation">{</span> <span class="token comment">// 测试用例使用map存储</span>
		<span class="token string">"simple"</span><span class="token punctuation">:</span>      <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"a:b:c"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">":"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"wrong sep"</span><span class="token punctuation">:</span>   <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"a:b:c"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">","</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a:b:c"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"more sep"</span><span class="token punctuation">:</span>    <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"abcd"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">"bc"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"leading sep"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>input<span class="token punctuation">:</span> <span class="token string">"沙河有沙又有河"</span><span class="token punctuation">,</span> sep<span class="token punctuation">:</span> <span class="token string">"沙"</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"河有"</span><span class="token punctuation">,</span> <span class="token string">"又有河"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	teardownTestCase <span class="token operator">:=</span> <span class="token function">setupTestCase</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token comment">// 测试之前执行setup操作</span>
	<span class="token keyword keyword-defer">defer</span> <span class="token function">teardownTestCase</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>            <span class="token comment">// 测试之后执行testdoen操作</span>

	<span class="token keyword keyword-for">for</span> name<span class="token punctuation">,</span> tc <span class="token operator">:=</span> <span class="token keyword keyword-range">range</span> tests <span class="token punctuation">{</span>
		t<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-func">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 使用t.Run()执行子测试</span>
			teardownSubTest <span class="token operator">:=</span> <span class="token function">setupSubTest</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token comment">// 子测试之前执行setup操作</span>
			<span class="token keyword keyword-defer">defer</span> <span class="token function">teardownSubTest</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>           <span class="token comment">// 测试之后执行testdoen操作</span>
			got <span class="token operator">:=</span> <span class="token function">Split</span><span class="token punctuation">(</span>tc<span class="token punctuation">.</span>input<span class="token punctuation">,</span> tc<span class="token punctuation">.</span>sep<span class="token punctuation">)</span>
			<span class="token keyword keyword-if">if</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> tc<span class="token punctuation">.</span>want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"excepted:%#v, got:%#v"</span><span class="token punctuation">,</span> tc<span class="token punctuation">.</span>want<span class="token punctuation">,</span> got<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>测试结果如下：</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -v
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit/simple
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit/wrong_sep
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit/more_sep
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestSplit/leading_sep
--- PASS: TestSplit <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
    split_test.go:71: 如有需要在此执行:测试之前的setup
    --- PASS: TestSplit/simple <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
        split_test.go:79: 如有需要在此执行:子测试之前的setup
        split_test.go:81: 如有需要在此执行:子测试之后的teardown
    --- PASS: TestSplit/wrong_sep <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
        split_test.go:79: 如有需要在此执行:子测试之前的setup
        split_test.go:81: 如有需要在此执行:子测试之后的teardown
    --- PASS: TestSplit/more_sep <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
        split_test.go:79: 如有需要在此执行:子测试之前的setup
        split_test.go:81: 如有需要在此执行:子测试之后的teardown
    --- PASS: TestSplit/leading_sep <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
        split_test.go:79: 如有需要在此执行:子测试之前的setup
        split_test.go:81: 如有需要在此执行:子测试之后的teardown
    split_test.go:73: 如有需要在此执行:测试之后的teardown
<span class="token operator">==</span><span class="token operator">=</span> RUN   ExampleSplit
--- PASS: ExampleSplit <span class="token punctuation">(</span>0.00s<span class="token punctuation">)</span>
PASS
ok      github.com/Q1mi/studygo/code_demo/test_demo/split       0.006s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="autoid-4-2-0">示例函数</h1>

<h2 id="autoid-5-0-0">示例函数的格式</h2>

<p>被<code>go test</code>特殊对待的第三种函数就是示例函数，它们的函数名以<code>Example</code>为前缀。它们既没有参数也没有返回值。标准格式如下：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">ExampleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="autoid-5-1-0">示例函数示例</h2>

<p>下面的代码是我们为<code>Split</code>函数编写的一个示例函数：</p>

<pre class="line-numbers language-go"><code class=" language-go"><span class="token keyword keyword-func">func</span> <span class="token function">ExampleSplit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>split<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">"a:b:c"</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>split<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">"沙河有沙又有河"</span><span class="token punctuation">,</span> <span class="token string">"沙"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// Output:</span>
	<span class="token comment">// [a b c]</span>
	<span class="token comment">// [ 河有 又有河]</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>为你的代码编写示例代码有如下三个用处：</p>

<ol>
<li><p>示例函数能够作为文档直接使用，例如基于web的godoc中能把示例函数与对应的函数或包相关联。</p></li>

<li><p>示例函数只要包含了<code>// Output:</code>也是可以通过<code>go test</code>运行的可执行测试。</p>

<pre class="line-numbers language-bash"><code class=" language-bash"><span class="token function">split</span> $ go <span class="token function">test</span> -run Example
PASS
ok      github.com/Q1mi/studygo/code_demo/test_demo/split       0.006s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>

<li><p>示例函数提供了可以直接运行的示例代码，可以直接在<code>golang.org</code>的<code>godoc</code>文档服务器上使用<code>Go Playground</code>运行示例代码。下图为<code>strings.ToUpper</code>函数在Playground的示例函数效果。
<img src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/example.png" alt="Go Playground"></p></li>
</ol>

<h1 id="autoid-5-2-0">练习题</h1>

<ol>
<li>编写一个回文检测函数，并为其编写单元测试和基准测试，根据测试的结果逐步对其进行优化。（回文：一个字符串正序和逆序一样，如“Madam,I’mAdam”、“油灯少灯油”等。）</li>
</ol>
                        <hr>
                        <p>
                            <img src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/wxgzh_qrcode.jpg" alt="扫码关注微信公众号">
                        </p>
                        </div>
                        
                        <div id="gitalk-container"></div>

                        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="https://www.liwenzhou.com/posts/Go/go_http/">Go语言基础之net/http</a></li>
        
        <li><a href="https://www.liwenzhou.com/posts/Go/15_socket/">Go语言基础之网络编程</a></li>
        
        <li><a href="https://www.liwenzhou.com/posts/Go/14_concurrence/">Go语言基础之并发</a></li>
        
        <li><a href="https://www.liwenzhou.com/posts/Go/13_reflect/">Go语言基础之反射</a></li>
        
        <li><a href="https://www.liwenzhou.com/posts/Go/12_interface/">Go语言基础之接口</a></li>
        
    </ul>
</div>


                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="https://www.liwenzhou.com/tags/Golang">Golang</a></li>
                                
                            </ul>
                            
                        </div>
                    </article>
                    
    

    
    
                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        
<div id="search" accept-charset="utf-8" _lpchecked="1">
  <ul id="s-u" class="search-result"></ul>
  <input id="s-k" type="text" autocomplete="off" name="key" maxlength="20" placeholder="搜索一下">
  <button id="s-b" type="button" class="submit icon-search"></button>
</div>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">我亲自录制的视频课程</h3>
        <a href="https://study.163.com/course/courseMain.htm?courseId=1210171207&amp;share=2&amp;shareId=480000002229610"><img src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/goweb2.png" width="250"></a>
        <h3 class="widget-title">微信扫码支持一下</h3>
        <img src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/zanshang_qr.jpg" width="256" height="239">
    </section>
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://www.liwenzhou.com/posts/Go/go_menu/" title="【置顶】Go语言学习之路/Go语言教程">【置顶】Go语言学习之路/Go语言教程</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/posts/Go/priority_in_go_select/" title="Go语言在select语句中实现优先级">Go语言在select语句中实现优先级</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/posts/Go/deploy_go_app/" title="部署Go语言项目的 N 种方法">部署Go语言项目的 N 种方法</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/posts/Go/ratelimit/" title="常用限流策略——漏桶与令牌桶介绍">常用限流策略——漏桶与令牌桶介绍</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/posts/Go/benchmark_tool/" title="常用的HTTP服务压测工具介绍">常用的HTTP服务压测工具介绍</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/posts/Go/gin_swagger/" title="使用swagger生成接口文档">使用swagger生成接口文档</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/posts/Go/makefile/" title="为Go项目编写Makefile">为Go项目编写Makefile</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/posts/Go/validator_usages/" title="validator库参数校验若干实用技巧">validator库参数校验若干实用技巧</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/posts/Go/read_gin_sourcecode/" title="gin框架源码解析">gin框架源码解析</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/posts/Go/use_zap_in_gin/" title="使用zap接收gin框架默认的日志并配置日志归档">使用zap接收gin框架默认的日志并配置日志归档</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://www.liwenzhou.com/categories/Development/">Development(14)</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/categories/Django/">Django(3)</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/categories/Front-end/">Front-end(1)</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/categories/Golang/">Golang(75)</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/categories/JavaScript/">JavaScript(1)</a>
    </li>
    
    <li>
        <a href="https://www.liwenzhou.com/categories/Python/">Python(13)</a>
    </li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="https://www.liwenzhou.com/tags/Development/">Development</a>
    
    <a href="https://www.liwenzhou.com/tags/Django/">Django</a>
    
    <a href="https://www.liwenzhou.com/tags/Golang/">Golang</a>
    
    <a href="https://www.liwenzhou.com/tags/Python/">Python</a>
    
    <a href="https://www.liwenzhou.com/tags/about/">about</a>
    
    <a href="https://www.liwenzhou.com/tags/front-end/">front-end</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://geektutu.com/" title="致力于分享有趣的技术实践">极客兔兔-有趣的技术实践</a>
        </li>
        
        <li>
            <a target="_blank" href="https://draveness.me/golang/" title="灯塔">draveness-Go语言设计与实现</a>
        </li>
        
        <li>
            <a target="_blank" href="https://www.cnblogs.com/liwenzhou/" title="Python全栈之路">Q1mi-Python全栈之路</a>
        </li>
        
        <li>
            <a target="_blank" href="https://www.cnblogs.com/zhaof" title="Python/Go语言之路">赵凡的博客</a>
        </li>
        
        <li>
            <a target="_blank" href="http://resn.cnblogs.com/" title="R_e-博客园">R_e-博客园</a>
        </li>
        
        <li>
            <a target="_blank" href="http://roddypy.com/" title="罗迪's Blog">罗迪's Blog</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">微信公众号</h3>
        <img src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/qrcode_for_gzh.jpg" width="258" height="258">
    </section>

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://www.liwenzhou.com/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
        © 2020 <a href="https://www.liwenzhou.com/">李文周的博客 By 李文周</a>.本站博客未经授权禁止转载.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io/" target="_blank">Hugo</a>.
        <a href="http://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/rujews/maupassant-hugo" target="_blank">maupassant</a>.<a href="http://www.beian.miit.gov.cn/">京ICP备15037996号-1</a>.
        
    </div>
</footer>


    <script type="text/javascript" src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/page.js" async="true"></script>
    <script type="text/javascript" src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/prism.js" async="true"></script>
    <script src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/MathJax.js" async=""></script>
    <link rel="stylesheet" href="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/gitalk.css">
    <script src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/gitalk.js"></script>

<a id="rocket" href="#top" class="show"></a>
<script type="text/javascript" src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/totop.js" async="true"></script>



<script type="text/javascript" src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/busuanzi.js" async=""></script>




  <script src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/bootstrap.js"></script>

  <script src="Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95_files/post_category.js"></script>



<div id="sideToolbar" style="display: block;"><div class="sideCatalogBg" id="sideCatalog" style="visibility: visible;"><div id="sideCatalog-catalog"><ul class="nav" style="width:225px;zoom:1"><li class=""><span>1&nbsp;&nbsp;</span><a href="#autoid-0-0-0" title="go test工具">go test工具</a><span class="sideCatalog-dot"></span></li><li class=""><span>2&nbsp;&nbsp;</span><a href="#autoid-1-0-0" title="测试函数">测试函数</a><span class="sideCatalog-dot"></span></li><li class="h2Offset"><span>2.1&nbsp;&nbsp;</span><a href="#autoid-2-0-0" title="测试函数的格式">测试函数的格式</a></li><li class="h2Offset"><span>2.2&nbsp;&nbsp;</span><a href="#autoid-2-1-0" title="测试函数示例">测试函数示例</a></li><li class="h2Offset active"><span>2.3&nbsp;&nbsp;</span><a href="#autoid-2-2-0" title="测试组">测试组</a></li><li class="h2Offset"><span>2.4&nbsp;&nbsp;</span><a href="#autoid-2-3-0" title="子测试">子测试</a></li><li class="h2Offset"><span>2.5&nbsp;&nbsp;</span><a href="#autoid-2-4-0" title="测试覆盖率">测试覆盖率</a></li><li><span>3&nbsp;&nbsp;</span><a href="#autoid-2-5-0" title="基准测试">基准测试</a><span class="sideCatalog-dot"></span></li><li class="h2Offset"><span>3.1&nbsp;&nbsp;</span><a href="#autoid-3-0-0" title="基准测试函数格式">基准测试函数格式</a></li><li class="h2Offset"><span>3.2&nbsp;&nbsp;</span><a href="#autoid-3-1-0" title="基准测试示例">基准测试示例</a></li><li class="h2Offset"><span>3.3&nbsp;&nbsp;</span><a href="#autoid-3-2-0" title="性能比较函数">性能比较函数</a></li><li class="h2Offset"><span>3.4&nbsp;&nbsp;</span><a href="#autoid-3-3-0" title="重置时间">重置时间</a></li><li class="h2Offset"><span>3.5&nbsp;&nbsp;</span><a href="#autoid-3-4-0" title="并行测试">并行测试</a></li><li><span>4&nbsp;&nbsp;</span><a href="#autoid-3-5-0" title="Setup与TearDown">Setup与TearDown</a><span class="sideCatalog-dot"></span></li><li class="h2Offset"><span>4.1&nbsp;&nbsp;</span><a href="#autoid-4-0-0" title="TestMain">TestMain</a></li><li class="h2Offset"><span>4.2&nbsp;&nbsp;</span><a href="#autoid-4-1-0" title="子测试的Setup与Teardown">子测试的Setup与Teardo...</a></li><li><span>5&nbsp;&nbsp;</span><a href="#autoid-4-2-0" title="示例函数">示例函数</a><span class="sideCatalog-dot"></span></li><li class="h2Offset"><span>5.1&nbsp;&nbsp;</span><a href="#autoid-5-0-0" title="示例函数的格式">示例函数的格式</a></li><li class="h2Offset"><span>5.2&nbsp;&nbsp;</span><a href="#autoid-5-1-0" title="示例函数示例">示例函数示例</a></li><li><span>6&nbsp;&nbsp;</span><a href="#autoid-5-2-0" title="练习题">练习题</a><span class="sideCatalog-dot"></span></li></ul></div></div><a href="javascript:void(0);" id="sideCatalogBtn" class="sideCatalogBtnDisable"></a></div></body></html>